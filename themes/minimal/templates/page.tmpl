{#
  page.tmpl - Minimal theme with collapsible sidebar navigation

  This is the base template for all pages in the site. It provides:
  - Complete HTML document structure (DOCTYPE, html, head, body)
  - Meta tags for SEO, favicons, canonical URLs
  - CSS includes (Pico CSS, theme.css, custom.css, highlight.js)
  - JavaScript includes (VenoBox, MiniSearch, hyperscript, highlight.js)
  - Simple header with site title
  - Collapsible sidebar with search, theme switch, and navigation
  - Main content area where page-specific content is rendered
  - Footer with site footer text

  Used by: All features as the wrapping template for rendered content
#}
<!DOCTYPE html>

<html lang="en" data-theme="dark">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  {% if noindex %}
  <meta name="robots" content="noindex" />{% endif %}
  <title>{{ site_title }}: {{ title }}</title>
  <meta name="description" content="{{ site_description }}" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="canonical" href="{{ canonical_url }}" />
  <link rel="alternate" type="application/rss+xml" href="/rss.xml" title="RSS Feed" />
  {% if extra_feed %}
  <link rel="alternate" type="application/rss+xml" href="{{ extra_feed.link }}" title="{{ extra_feed.title }}" />
  {% endif %}
  <!-- Pico CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.colors.min.css" />
  <!-- Lightbox -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/venobox@2.0.4/dist/venobox.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/venobox@2.0.4/dist/venobox.min.js"></script>
  <script src="https://unpkg.com/hyperscript.org@0.9.9"></script>
  <script src="https://cdn.jsdelivr.net/npm/minisearch@6.1.0/dist/umd/index.min.js"></script>
  {% if not no_highlightjs %}
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/django.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlightjs-copy@1.0.3/dist/highlightjs-copy.min.css" />
  <script src="https://unpkg.com/highlightjs-copy@1.0.3/dist/highlightjs-copy.min.js"></script>
  {% endif %}
  <!-- Theme styles -->
  <link rel="stylesheet" href="/css/theme.css" />
  <!-- Base16 color scheme (light/dark themes) -->
  <link rel="stylesheet" href="/css/style.css" />
  <!-- Custom style (loaded last for user overrides) -->
  <link rel="stylesheet" href="/css/custom.css" />
  {% if listings_css %}
  <link rel="stylesheet" href="/css/listings.css" />
  {% endif %}
</head>

<body>
  <!-- Site Header -->
  <header class="site-header">
    <button id="sidebar-toggle" class="sidebar-toggle" aria-label="Toggle sidebar">
      <span></span>
    </button>
    <div class="site-title">
      <h1><a href="{{site_url}}">{{ site_title }}</a></h1>
      <p>{{ site_description }}</p>
    </div>
  </header>

  <!-- Sidebar Navigation -->
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-content">
      <!-- Search -->
      <div class="sidebar-section">
        <input type="search" id="search" placeholder="Search..." />
      </div>

      <!-- Navigation Links -->
      <div class="sidebar-section">
        <nav>
          <ul>
            {% for item in site_nav_items %}
            <li>{{item}}</li>
            {% endfor %}
          </ul>
        </nav>
      </div>

      <!-- Extra Sidebar Content (e.g., Book TOC) -->
      {% if sidebar_content %}
      <div class="sidebar-section">
        {{ sidebar_content }}
      </div>
      {% endif %}

      <!-- Language Switcher -->
      {% if language_links and language_links|length > 0 %}
      <div class="sidebar-section">
        <details>
          <summary>Language</summary>
          <ul>
            {% for link in language_links %}
            <li><a href="{{link.link}}">{{link.lang}} - {{link.title}}</a></li>
            {% endfor %}
          </ul>
        </details>
      </div>
      {% endif %}

      <!-- Theme Switcher -->
      <div class="sidebar-section">
        <label>
          <input type="checkbox" id="switch_theme" name="switch" role="switch" value="1" _="
              def setTheme()
                get the closest <html/>
                if cookies['isLight'] is 'true'
                  set its @data-theme to 'light'
                  set cookies['isLight'] to true
                  set my @checked to false
                else
                  set its @data-theme to 'dark'
                  set cookies['isLight'] to false
                  set my @checked to true
              end
              init setTheme() end
              on change
                set cookies['isLight'] to (cookies['isLight'] is not 'true')
                setTheme()
            " />
          Dark Mode
        </label>
      </div>
    </div>
  </aside>

  <div id="search_results"></div>

  <!-- Main Content -->
  <main class="main-content">
    {{ content }}
  </main>

  <!-- Footer -->
  <footer class="footer">
    <small>{{ site_footer }}</small>
    <small>Minimal Theme Â· Built with <a href="https://picocss.com">Pico</a></small>
  </footer>

  <script>
    function toggleSidebar() {
      document.body.classList.toggle('sidebar-open');
    }
    document.getElementById('sidebar-toggle').addEventListener('click', toggleSidebar);

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function(e) {
      const sidebar = document.getElementById('sidebar');
      const toggle = document.getElementById('sidebar-toggle');
      if (window.innerWidth < 768 &&
          !sidebar.contains(e.target) &&
          !toggle.contains(e.target) &&
          document.body.classList.contains('sidebar-open')) {
        document.body.classList.remove('sidebar-open');
      }
    });

    new VenoBox({
      selector: "div.lightbox div a, div.lightbox p a, figure.lightbox a",
      spinner: "fold",
      numeration: true,
      share: true,
      maxWidth: "80%",
    });
    {% if not no_highlightjs %}
    hljs.highlightAll();
    hljs.addPlugin(new CopyButtonPlugin());
    {% endif %}
  </script>
  <script src="/search.js"></script>
</body>

</html>
