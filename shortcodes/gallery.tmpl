{# Gallery shortcode - embed gallery images from gallery.json
  Usage: gallery name="my-gallery" or gallery my-gallery

  Supported arguments:
  - name: Gallery folder name (required)
  - css_class: CSS class for the container (default: "gallery-embed")
#}
{% set gallery_name = args['name'] %}
{% if not gallery_name %}
  {% set gallery_name = args['0'] %}
{% endif %}
{% if not gallery_name %}
  {% set gallery_name = 'unknown' %}
{% endif %}
{% set gallery_class = 'gallery-embed' %}
{% if args['css_class'] %}
  {% set gallery_class = args['css_class'] %}
{% endif %}
{% set gallery_id = 'gallery-' ~ gallery_name ~ '-' ~ range(0, 100000) | random %}
<div class="{{ gallery_class }}" id="{{ gallery_id }}" data-gallery="/galleries/{{ gallery_name }}/gallery.json">
  <noscript>
    <p><a href="/galleries/{{ gallery_name }}/">View Gallery</a></p>
  </noscript>
</div>
<script>
(function() {
  const container = document.getElementById('{{ gallery_id }}');
  const url = container.dataset.gallery;

  fetch(url).then(r => r.json()).then(data => {
    if (!data.images || data.images.length === 0) {
      container.innerHTML = '<p>No images in this gallery</p>';
      return;
    }

    // Clear container
    container.innerHTML = '';

    // Create main wrapper
    const wrapper = document.createElement('div');
    wrapper.className = 'gallery lightbox';

    // Process images in chunks of 5
    for (let i = 0; i < data.images.length; i++) {
      // Start new grid every 5 images
      if (i % 5 === 0) {
        const grid = document.createElement('div');
        grid.className = 'grid';
        wrapper.appendChild(grid);
      }

      // Get current grid (last child of wrapper)
      const grid = wrapper.lastChild;

      // Create link
      const img = data.images[i];
      const link = document.createElement('a');
      link.href = img.url;
      link.setAttribute('data-gall', 'gallery-{{ gallery_id }}');

      // Create image
      const image = document.createElement('img');
      image.src = img.thumb;
      image.alt = img.filename;
      image.loading = 'lazy';

      link.appendChild(image);
      grid.appendChild(link);
    }

    container.appendChild(wrapper);

    // Initialize VenoBox for the gallery links
    if (typeof VenoBox !== 'undefined') {
      VenoBox({
        selector: '#{{ gallery_id }} .lightbox a',
        spinner: "fold",
        numeration: true,
        share: true,
        maxWidth: "80%",
      });
    }
  }).catch(err => {
    console.error('Gallery error:', err);
    container.innerHTML = '<p>Error loading gallery. <a href="/galleries/{{ gallery_name }}/">View gallery page</a></p>';
  });
})();
</script>
